// src/utils/sounds.js
export const DEFAULT_SOUND_PATH_PREFIX = '/assets/sounds/kits/tr808/';

export const tr808SoundFiles = { /* ... (Your full list of sound files remains unchanged) ... */
 // BD (Bass Drum)
 'BD0000': `${DEFAULT_SOUND_PATH_PREFIX}BD0000.wav`, 'BD0010': `${DEFAULT_SOUND_PATH_PREFIX}BD0010.wav`, // ... and so on for all sounds
 'BD0025': `${DEFAULT_SOUND_PATH_PREFIX}BD0025.wav`, 'BD0050': `${DEFAULT_SOUND_PATH_PREFIX}BD0050.wav`,
 'BD0075': `${DEFAULT_SOUND_PATH_PREFIX}BD0075.wav`, 'BD1000': `${DEFAULT_SOUND_PATH_PREFIX}BD1000.wav`,
 'BD1010': `${DEFAULT_SOUND_PATH_PREFIX}BD1010.wav`, 'BD1025': `${DEFAULT_SOUND_PATH_PREFIX}BD1025.wav`,
 'BD1050': `${DEFAULT_SOUND_PATH_PREFIX}BD1050.wav`, 'BD1075': `${DEFAULT_SOUND_PATH_PREFIX}BD1075.wav`,
 'BD2500': `${DEFAULT_SOUND_PATH_PREFIX}BD2500.wav`, 'BD2510': `${DEFAULT_SOUND_PATH_PREFIX}BD2510.wav`,
 'BD2525': `${DEFAULT_SOUND_PATH_PREFIX}BD2525.wav`, 'BD2550': `${DEFAULT_SOUND_PATH_PREFIX}BD2550.wav`,
 'BD2575': `${DEFAULT_SOUND_PATH_PREFIX}BD2575.wav`, 'BD5000': `${DEFAULT_SOUND_PATH_PREFIX}BD5000.wav`,
 'BD5010': `${DEFAULT_SOUND_PATH_PREFIX}BD5010.wav`, 'BD5025': `${DEFAULT_SOUND_PATH_PREFIX}BD5025.wav`,
 'BD5050': `${DEFAULT_SOUND_PATH_PREFIX}BD5050.wav`, 'BD5075': `${DEFAULT_SOUND_PATH_PREFIX}BD5075.wav`,
 'BD7500': `${DEFAULT_SOUND_PATH_PREFIX}BD7500.wav`, 'BD7510': `${DEFAULT_SOUND_PATH_PREFIX}BD7510.wav`,
 'BD7525': `${DEFAULT_SOUND_PATH_PREFIX}BD7525.wav`, 'BD7550': `${DEFAULT_SOUND_PATH_PREFIX}BD7550.wav`,
 'BD7575': `${DEFAULT_SOUND_PATH_PREFIX}BD7575.wav`,
 'CB': `${DEFAULT_SOUND_PATH_PREFIX}CB.wav`, 'CH': `${DEFAULT_SOUND_PATH_PREFIX}CH.wav`,
 'CL': `${DEFAULT_SOUND_PATH_PREFIX}CL.wav`, 'CP': `${DEFAULT_SOUND_PATH_PREFIX}CP.wav`,
 'CY0000': `${DEFAULT_SOUND_PATH_PREFIX}CY0000.wav`, 'CY0010': `${DEFAULT_SOUND_PATH_PREFIX}CY0010.wav`,
 'CY0025': `${DEFAULT_SOUND_PATH_PREFIX}CY0025.wav`, 'CY0050': `${DEFAULT_SOUND_PATH_PREFIX}CY0050.wav`,
 'CY0075': `${DEFAULT_SOUND_PATH_PREFIX}CY0075.wav`, 'CY1000': `${DEFAULT_SOUND_PATH_PREFIX}CY1000.wav`,
 'CY1010': `${DEFAULT_SOUND_PATH_PREFIX}CY1010.wav`, 'CY1025': `${DEFAULT_SOUND_PATH_PREFIX}CY1025.wav`,
 'CY1050': `${DEFAULT_SOUND_PATH_PREFIX}CY1050.wav`, 'CY1075': `${DEFAULT_SOUND_PATH_PREFIX}CY1075.wav`,
 'CY2500': `${DEFAULT_SOUND_PATH_PREFIX}CY2500.wav`, 'CY2510': `${DEFAULT_SOUND_PATH_PREFIX}CY2510.wav`,
 'CY2525': `${DEFAULT_SOUND_PATH_PREFIX}CY2525.wav`, 'CY2550': `${DEFAULT_SOUND_PATH_PREFIX}CY2550.wav`,
 'CY2575': `${DEFAULT_SOUND_PATH_PREFIX}CY2575.wav`, 'CY5000': `${DEFAULT_SOUND_PATH_PREFIX}CY5000.wav`,
 'CY5010': `${DEFAULT_SOUND_PATH_PREFIX}CY5010.wav`, 'CY5025': `${DEFAULT_SOUND_PATH_PREFIX}CY5025.wav`,
 'CY5050': `${DEFAULT_SOUND_PATH_PREFIX}CY5050.wav`, 'CY5075': `${DEFAULT_SOUND_PATH_PREFIX}CY5075.wav`,
 'CY7500': `${DEFAULT_SOUND_PATH_PREFIX}CY7500.wav`, 'CY7510': `${DEFAULT_SOUND_PATH_PREFIX}CY7510.wav`,
 'CY7525': `${DEFAULT_SOUND_PATH_PREFIX}CY7525.wav`, 'CY7550': `${DEFAULT_SOUND_PATH_PREFIX}CY7550.wav`,
 'CY7575': `${DEFAULT_SOUND_PATH_PREFIX}CY7575.wav`,
 'HC00': `${DEFAULT_SOUND_PATH_PREFIX}HC00.wav`, 'HC10': `${DEFAULT_SOUND_PATH_PREFIX}HC10.wav`,
 'HC25': `${DEFAULT_SOUND_PATH_PREFIX}HC25.wav`, 'HC50': `${DEFAULT_SOUND_PATH_PREFIX}HC50.wav`,
 'HC75': `${DEFAULT_SOUND_PATH_PREFIX}HC75.wav`,
 'HT00': `${DEFAULT_SOUND_PATH_PREFIX}HT00.wav`, 'HT10': `${DEFAULT_SOUND_PATH_PREFIX}HT10.wav`,
 'HT25': `${DEFAULT_SOUND_PATH_PREFIX}HT25.wav`, 'HT50': `${DEFAULT_SOUND_PATH_PREFIX}HT50.wav`,
 'HT75': `${DEFAULT_SOUND_PATH_PREFIX}HT75.wav`,
 'LC00': `${DEFAULT_SOUND_PATH_PREFIX}LC00.wav`, 'LC10': `${DEFAULT_SOUND_PATH_PREFIX}LC10.wav`,
 'LC25': `${DEFAULT_SOUND_PATH_PREFIX}LC25.wav`, 'LC50': `${DEFAULT_SOUND_PATH_PREFIX}LC50.wav`,
 'LC75': `${DEFAULT_SOUND_PATH_PREFIX}LC75.wav`,
 'LT00': `${DEFAULT_SOUND_PATH_PREFIX}LT00.wav`, 'LT10': `${DEFAULT_SOUND_PATH_PREFIX}LT10.wav`,
 'LT25': `${DEFAULT_SOUND_PATH_PREFIX}LT25.wav`, 'LT50': `${DEFAULT_SOUND_PATH_PREFIX}LT50.wav`,
 'LT75': `${DEFAULT_SOUND_PATH_PREFIX}LT75.wav`,
 'MA': `${DEFAULT_SOUND_PATH_PREFIX}MA.wav`,
 'MC00': `${DEFAULT_SOUND_PATH_PREFIX}MC00.wav`, 'MC10': `${DEFAULT_SOUND_PATH_PREFIX}MC10.wav`,
 'MC25': `${DEFAULT_SOUND_PATH_PREFIX}MC25.wav`, 'MC50': `${DEFAULT_SOUND_PATH_PREFIX}MC50.wav`,
 'MC75': `${DEFAULT_SOUND_PATH_PREFIX}MC75.wav`,
 'MT00': `${DEFAULT_SOUND_PATH_PREFIX}MT00.wav`, 'MT10': `${DEFAULT_SOUND_PATH_PREFIX}MT10.wav`,
 'MT25': `${DEFAULT_SOUND_PATH_PREFIX}MT25.wav`, 'MT50': `${DEFAULT_SOUND_PATH_PREFIX}MT50.wav`,
 'MT75': `${DEFAULT_SOUND_PATH_PREFIX}MT75.wav`,
 'OH00': `${DEFAULT_SOUND_PATH_PREFIX}OH00.wav`, 'OH10': `${DEFAULT_SOUND_PATH_PREFIX}OH10.wav`,
 'OH25': `${DEFAULT_SOUND_PATH_PREFIX}OH25.wav`, 'OH50': `${DEFAULT_SOUND_PATH_PREFIX}OH50.wav`,
 'OH75': `${DEFAULT_SOUND_PATH_PREFIX}OH75.wav`,
 'RS': `${DEFAULT_SOUND_PATH_PREFIX}RS.wav`,
 'SD0000': `${DEFAULT_SOUND_PATH_PREFIX}SD0000.wav`, 'SD0010': `${DEFAULT_SOUND_PATH_PREFIX}SD0010.wav`,
 'SD0025': `${DEFAULT_SOUND_PATH_PREFIX}SD0025.wav`, 'SD0050': `${DEFAULT_SOUND_PATH_PREFIX}SD0050.wav`,
 'SD0075': `${DEFAULT_SOUND_PATH_PREFIX}SD0075.wav`, 'SD1000': `${DEFAULT_SOUND_PATH_PREFIX}SD1000.wav`,
 'SD1010': `${DEFAULT_SOUND_PATH_PREFIX}SD1010.wav`, 'SD1025': `${DEFAULT_SOUND_PATH_PREFIX}SD1025.wav`,
 'SD1050': `${DEFAULT_SOUND_PATH_PREFIX}SD1050.wav`, 'SD1075': `${DEFAULT_SOUND_PATH_PREFIX}SD1075.wav`,
 'SD2500': `${DEFAULT_SOUND_PATH_PREFIX}SD2500.wav`, 'SD2510': `${DEFAULT_SOUND_PATH_PREFIX}SD2510.wav`,
 'SD2525': `${DEFAULT_SOUND_PATH_PREFIX}SD2525.wav`, 'SD2550': `${DEFAULT_SOUND_PATH_PREFIX}SD2550.wav`,
 'SD2575': `${DEFAULT_SOUND_PATH_PREFIX}SD2575.wav`, 'SD5000': `${DEFAULT_SOUND_PATH_PREFIX}SD5000.wav`,
 'SD5010': `${DEFAULT_SOUND_PATH_PREFIX}SD5010.wav`, 'SD5025': `${DEFAULT_SOUND_PATH_PREFIX}SD5025.wav`,
 'SD5050': `${DEFAULT_SOUND_PATH_PREFIX}SD5050.wav`, 'SD5075': `${DEFAULT_SOUND_PATH_PREFIX}SD5075.wav`,
 'SD7500': `${DEFAULT_SOUND_PATH_PREFIX}SD7500.wav`, 'SD7510': `${DEFAULT_SOUND_PATH_PREFIX}SD7510.wav`,
 'SD7525': `${DEFAULT_SOUND_PATH_PREFIX}SD7525.wav`, 'SD7550': `${DEFAULT_SOUND_PATH_PREFIX}SD7550.wav`,
 'SD7575': `${DEFAULT_SOUND_PATH_PREFIX}SD7575.wav`,
};

export const tr808SoundKeys = Object.keys(tr808SoundFiles);

export const getSoundNameFromPath = (soundKeyOrPath) => {
  if (!soundKeyOrPath) return 'N/A';
  // If it's a key present in tr808SoundFiles, return the key itself (which is the short name)
  if (tr808SoundFiles[soundKeyOrPath]) {
    return soundKeyOrPath;
  }
  // Otherwise, assume it's a full path and extract the filename without extension
  const parts = soundKeyOrPath.split('/');
  const fileName = parts[parts.length - 1];
  return fileName.split('.')[0];
};

export const ALL_JOINTS_MAP = {
  HEAD: { name: 'Head', type: 'Head' }, NECK: { name: 'Neck', type: 'Spine' },
  CHEST: { name: 'Chest', type: 'Torso' },
  SPIN_T: { name: 'Thoracic Spine', type: 'Spine' }, SPIN_L: { name: 'Lumbar Spine', type: 'Spine' },
  PELV: { name: 'Pelvis', type: 'Torso' }, HIPS: { name: 'Hips Center', type: 'Torso' },
  L_SHO: { name: 'Left Shoulder', type: 'Arm' }, R_SHO: { name: 'Right Shoulder', type: 'Arm' },
  L_ELB: { name: 'Left Elbow', type: 'Arm' }, R_ELB: { name: 'Right Elbow', type: 'Arm' },
  L_WRST: { name: 'Left Wrist', type: 'Arm' }, R_WRST: { name: 'Right Wrist', type: 'Arm' },
  L_HAND: { name: 'Left Hand', type: 'Hand' }, R_HAND: { name: 'Right Hand', type: 'Hand' },
  L_HIP: { name: 'Left Hip', type: 'Leg' }, R_HIP: { name: 'Right Hip', type: 'Leg' },
  L_KNEE: { name: 'Left Knee', type: 'Leg' }, R_KNEE: { name: 'Right Knee', type: 'Leg' },
  L_ANK: { name: 'Left Ankle', type: 'Leg' }, R_ANK: { name: 'Right Ankle', type: 'Leg' },
  L_FOOT: { name: 'Left Foot', type: 'Foot' }, R_FOOT: { name: 'Right Foot', type: 'Foot' },
  // Can add more detailed joints like SCAPULA, PALM if needed for direct selection
  L_SCAP: { name: 'Left Scapula', type: 'Torso' }, R_SCAP: { name: 'Right Scapula', type: 'Torso' },
};

// CORRECTED STRUCTURE FOR SIDE JOINT SELECTORS
  export const UI_LEFT_JOINTS_ABBREVS_NEW = [ // <<< It IS exported here
    { abbrev: 'L_SHO', name: 'Left Shoulder' }, { abbrev: 'L_ELB', name: 'Left Elbow' },
    { abbrev: 'L_WRST', name: 'Left Wrist' },   { abbrev: 'L_HIP', name: 'Left Hip' },
    { abbrev: 'L_KNEE', name: 'Left Knee' },    { abbrev: 'L_ANK', name: 'Left Ankle' },
  ];
  export const UI_RIGHT_JOINTS_ABBREVS_NEW = [ // <<< And here
    { abbrev: 'R_SHO', name: 'Right Shoulder' }, { abbrev: 'R_ELB', name: 'Right Elbow' },
    { abbrev: 'R_WRST', name: 'Right Wrist' },  { abbrev: 'R_HIP', name: 'Right Hip' },
    { abbrev: 'R_KNEE', name: 'Right Knee' },   { abbrev: 'R_ANK', name: 'Right Ankle' },
  ];

  // DEPRECATED - Use UI_..._NEW versions instead
  export const UI_LEFT_JOINTS_ABBREVS = ['L_SHO', 'L_ELB', 'L_WRST', 'L_HIP', 'L_KNEE', 'L_ANK'];
  export const UI_RIGHT_JOINTS_ABBREVS = ['R_SHO', 'R_ELB', 'R_WRST', 'R_HIP', 'R_KNEE', 'R_ANK'];

// GROUNDING POINTS
export const GROUND_POINT_OPTIONS = [ /* ... (Your full list of ground points remains unchanged) ... */
  { id: 'LF1', name: 'LF Ball Big Toe', side: 'L', description: 'Left Foot - Section 1 (Big Toe Ball)' },
  { id: 'LF2', name: 'LF Ball Pinky Toe', side: 'L', description: 'Left Foot - Section 2 (Pinky Toe Ball)' },
  { id: 'LF3', name: 'LF Heel', side: 'L', description: 'Left Foot - Section 3 (Heel)' },
  { id: 'LF12', name: 'LF Front Ball', side: 'L', description: 'Left Foot - Front (Sections 1 & 2)' },
  { id: 'LF13', name: 'LF Inner Blade', side: 'L', description: 'Left Foot - Inner Blade (Sections 1 & 3)' },
  { id: 'LF23', name: 'LF Outer Blade', side: 'L', description: 'Left Foot - Outer Blade (Sections 2 & 3)' },
  { id: 'LF123', name: 'LF Full Sole', side: 'L', description: 'Left Foot - Full Sole Contact (Sections 1, 2, 3)' },
  { id: 'LFT1', name: 'LF Big Toe', side: 'L', description: 'Left Foot - Big Toe Print Only' },
  { id: 'LFT12', name: 'LF Big & 2nd Toe', side: 'L', description: 'Left Foot - Big & 2nd Toe Prints' },
  { id: 'LFT12345', name: 'LF All Toes', side: 'L', description: 'Left Foot - All 5 Toe Prints' },
  { id: 'LF1T1', name: 'LF Ball Big Toe + Big Toe', side: 'L', description: 'Left Foot - Section 1 & Big Toe Print' },
  { id: 'LF123T12345', name: 'LF Full Plant', side: 'L', description: 'Left Foot - Full Plant (Sole & All Toes)' },
  { id: 'LF_NEUTRAL', name: 'LF Neutral/Airborne', side: 'L', description: 'Left Foot Neutral or Airborne' },
  { id: 'RF1', name: 'RF Ball Big Toe', side: 'R', description: 'Right Foot - Section 1 (Big Toe Ball)' },
  { id: 'RF2', name: 'RF Ball Pinky Toe', side: 'R', description: 'Right Foot - Section 2 (Pinky Toe Ball)' },
  { id: 'RF3', name: 'RF Heel', side: 'R', description: 'Right Foot - Section 3 (Heel)' },
  { id: 'RF12', name: 'RF Front Ball', side: 'R', description: 'Right Foot - Front (Sections 1 & 2)' },
  { id: 'RF13', name: 'RF Inner Blade', side: 'R', description: 'Right Foot - Inner Blade (Sections 1 & 3)' },
  { id: 'RF23', name: 'RF Outer Blade', side: 'R', description: 'Right Foot - Outer Blade (Sections 2 & 3)' },
  { id: 'RF123', name: 'RF Full Sole', side: 'R', description: 'Right Foot - Full Sole Contact (Sections 1, 2, 3)' },
  { id: 'RFT1', name: 'RF Big Toe', side: 'R', description: 'Right Foot - Big Toe Print Only' },
  { id: 'RFT12', name: 'RF Big & 2nd Toe', side: 'R', description: 'Right Foot - Big & 2nd Toe Prints' },
  { id: 'RFT12345', name: 'RF All Toes', side: 'R', description: 'Right Foot - All 5 Toe Prints' },
  { id: 'RF1T1', name: 'RF Ball Big Toe + Big Toe', side: 'R', description: 'Right Foot - Section 1 & Big Toe Print' },
  { id: 'RF123T12345', name: 'RF Full Plant', side: 'R', description: 'Right Foot - Full Plant (Sole & All Toes)' },
  { id: 'RF_NEUTRAL', name: 'RF Neutral/Airborne', side: 'R', description: 'Right Foot Neutral or Airborne' },
];

// FOOT JOYSTICK MAPS (For FootJoystickOverlay component)
// Assuming your L12T012345_Joystick_Map.png corresponds to these zones
export const LEFT_FOOT_JOYSTICK_MAP = {
  N:    { points: ['LF12T12345'], label: 'L Ball & All Toes' },
  NE:   { points: ['LF12T12'],    label: 'L Ball & Inner Toes' },
  E:    { points: ['LF1', 'LF12'],   label: 'L Inner Ball' }, // Could also be just LF1
  SE:   { points: ['LF13'],       label: 'L Inner Blade' },
  S:    { points: ['LF3'],        label: 'L Heel' },
  SW:   { points: ['LF23'],       label: 'L Outer Blade' },
  W:    { points: ['LF2', 'LF12'],   label: 'L Outer Ball' }, // Could also be just LF2
  NW:   { points: ['LF12T345'],   label: 'L Ball & Outer Toes' },
  CENTER_TAP: { points: ['LF123T12345'], label: 'L Full Plant' }, // Tap center for full plant
};

export const RIGHT_FOOT_JOYSTICK_MAP = {
  N:    { points: ['RF12T12345'], label: 'R Ball & All Toes' },
  NE:   { points: ['RF12T12'],    label: 'R Ball & Inner Toes' },
  E:    { points: ['RF1', 'RF12'],   label: 'R Inner Ball' },
  SE:   { points: ['RF13'],       label: 'R Inner Blade' },
  S:    { points: ['RF3'],        label: 'R Heel' },
  SW:   { points: ['RF23'],       label: 'R Outer Blade' },
  W:    { points: ['RF2', 'RF12'],   label: 'R Outer Ball' },
  NW:   { points: ['RF12T345'],   label: 'R Ball & Outer Toes' },
  CENTER_TAP: { points: ['RF123T12345'], label: 'R Full Plant' },
};

// Helper for FootJoystickOverlay
export const JOYSTICK_ZONES_ANGLES = [ // Angles for 8 cardinal directions + center
  { zone: 'E',  minAngle: -22.5, maxAngle: 22.5 },    // 0 degrees is East
  { zone: 'NE', minAngle: 22.5,  maxAngle: 67.5 },
  { zone: 'N',  minAngle: 67.5,  maxAngle: 112.5 },   // 90 degrees is North
  { zone: 'NW', minAngle: 112.5, maxAngle: 157.5 },
  { zone: 'W',  minAngle: 157.5, maxAngle: 180.001 }, // Handle West straddling 180
  { zone: 'W_NEG',minAngle: -180, maxAngle: -157.5 }, // Handle West straddling -180
  { zone: 'SW', minAngle: -157.5,maxAngle: -112.5 },
  { zone: 'S',  minAngle: -112.5,maxAngle: -67.5 },    // -90 degrees is South
  { zone: 'SE', minAngle: -67.5, maxAngle: -22.5 },
];

export const getZoneFromCoordinates = (x, y, centerX, centerY, radius) => {
  const dx = x - centerX;
  const dy = centerY - y; // Invert y for typical Cartesian where up is positive
  const distance = Math.sqrt(dx * dx + dy * dy);

  if (distance < radius * 0.25) { // Dead zone for center tap (25% of radius)
    return 'CENTER_TAP';
  }

  let angle = Math.atan2(dy, dx) * (180 / Math.PI); // Angle in degrees (-180 to 180)

  for (const zoneDef of JOYSTICK_ZONES_ANGLES) {
    if (zoneDef.zone === 'W' && (angle > 157.5 || angle <= -157.5)) return 'W'; // Special case for West
    if (zoneDef.zone === 'W_NEG') continue; // Already handled by 'W'
    if (angle >= zoneDef.minAngle && angle < zoneDef.maxAngle) {
      return zoneDef.zone;
    }
  }
  return null; // Should ideally not be reached if zones are comprehensive
};


// Function to get all sound files (paths) for preloading
export const getActiveKitSoundFiles = () => Object.values(tr808SoundFiles);

// Function to get categorized sounds (optional, for a more complex SoundBank UI)
export const getActiveKitCategorizedSounds = () => {
  const categories = {
    Kicks: tr808SoundKeys.filter(k => k.startsWith('BD')),
    Snares: tr808SoundKeys.filter(k => k.startsWith('SD')),
    Hats: tr808SoundKeys.filter(k => k.startsWith('CH') || k.startsWith('OH')),
    Cymbals: tr808SoundKeys.filter(k => k.startsWith('CY')),
    Toms: tr808SoundKeys.filter(k => k.startsWith('HT') || k.startsWith('MT') || k.startsWith('LT')),
    Percussion: tr808SoundKeys.filter(k => ['RS', 'CP', 'MA', 'CB', 'CL'].includes(k)), // Use direct keys for single samples
    Congas: tr808SoundKeys.filter(k => k.startsWith('HC') || k.startsWith('MC') || k.startsWith('LC')),
  };
  // Filter out empty categories
  return Object.fromEntries(Object.entries(categories).filter(([_, sounds]) => sounds.length > 0));
};